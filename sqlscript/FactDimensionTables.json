{
	"name": "FactDimensionTables",
	"properties": {
		"content": {
			"query": "-- Lab - Building a Fact Table\n-- Lets first create a view\n\n  CREATE VIEW [Sales_Fact_View]\n  AS\n  SELECT dt.[ProductID],dt.[SalesOrderID],dt.[OrderQty],dt.[UnitPrice],hd.[OrderDate],hd.[CustomerID],hd.[TaxAmt]\n  FROM [Sales].[SalesOrderDetail] dt\n  LEFT JOIN [Sales].[SalesOrderHeader] hd\n  ON dt.[SalesOrderID]=hd.[SalesOrderID]\n\n-- Then we will create the Sales Fact table from the view\n  \nSELECT [ProductID],[SalesOrderID],[CustomerID],[OrderQty],[UnitPrice],[OrderDate],[TaxAmt]\nINTO SalesFact\nFROM Sales_Fact_View\n\n\n-- Lab - Building a dimension table\n-- Lets build a view for the customers\n\nCREATE VIEW Customer_view \nAS\n  SELECT ct.[CustomerID],ct.[StoreID],st.[BusinessEntityID],st.[Name]  as StoreName\n  FROM [Sales].[Customer] as ct\n  LEFT JOIN [Sales].[Store] as st \n  ON ct.[StoreID]=st.[BusinessEntityID]\n  WHERE  st.[BusinessEntityID] IS NOT NULL\n\n-- Lets create a customer dimension table\n\nSELECT [CustomerID],[StoreID],[BusinessEntityID],StoreName\nINTO DimCustomer\nFROM Customer_view \n\n\n-- Lets build a view for the products\n\nCREATE VIEW Product_view \nAS\nSELECT prod.[ProductID],prod.[Name] as ProductName,prod.[SafetyStockLevel],model.[ProductModelID],model.[Name] as ProductModelName,category.[ProductSubcategoryID],category.[Name] AS ProductSubCategoryName\nFROM [Production].[Product] prod\nLEFT JOIN [Production].[ProductModel] model ON prod.[ProductModelID] = model.[ProductModelID]\nLEFT JOIN [Production].[ProductSubcategory] category ON prod.[ProductSubcategoryID]=category.[ProductSubcategoryID]\nWHERE prod.[ProductModelID] IS NOT NULL\n\n-- Lets create a product dimension table\n\nSELECT [ProductID],[ProductModelID],[ProductSubcategoryID],ProductName,[SafetyStockLevel],ProductModelName,ProductSubCategoryName\nINTO DimProduct\nFROM Product_view \n\n-- If you want to drop the views and the tables\n\nDROP VIEW Customer_view \n\nDROP TABLE DimCustomer\n\nDROP VIEW Product_view \n\nDROP TABLE DimProduct\n\n-- This is just a sample query that can be used to join both the Dimension and the Fact table\n\nSELECT dimc.StoreName,dimp.ProductName,dimp.ProductSubCategoryName,SUM(ft.OrderQty) AS Quantity\nFROM SalesFact ft\nINNER JOIN DimCustomer dimc ON ft.CustomerID=dimc.CustomerID\nINNER JOIN DimProduct dimp ON ft.ProductID=dimp.ProductID\nGROUP BY dimc.StoreName,dimp.ProductName,dimp.ProductSubCategoryName\n\n\n-- Lab - Transfer data to our SQL Pool\n\n-- First let's ensure we have the tables defined in the SQL pool\n\nCREATE TABLE [dbo].[SalesFact](\n\t[ProductID] [int] NOT NULL,\n\t[SalesOrderID] [int] NOT NULL,\n\t[CustomerID] [int] NOT NULL,\n\t[OrderQty] [smallint] NOT NULL,\n\t[UnitPrice] [money] NOT NULL,\n\t[OrderDate] [datetime] NULL,\n\t[TaxAmt] [money] NULL\n)\n\n\nCREATE TABLE [dbo].[DimCustomer](\n\t[CustomerID] [int] NOT NULL,\n\t[StoreID] [int] NOT NULL,\n\t[BusinessEntityID] [int] NOT NULL,\n\t[StoreName] varchar(50) NOT NULL\n)\n\n\nCREATE TABLE [dbo].[DimProduct](\n\t[ProductID] [int] NOT NULL,\n\t[ProductModelID] [int] NOT NULL,\n\t[ProductSubcategoryID] [int] NOT NULL,\n\t[ProductName] varchar(50) NOT NULL,\n\t[SafetyStockLevel] [smallint] NOT NULL,\n\t[ProductModelName] varchar(50) NULL,\n\t[ProductSubCategoryName] varchar(50) NULL\n)\n\nSELECT * FROM [dbo].[SalesFact]\nSELECT COUNT(*) FROM [dbo].[SalesFact]\n\nSELECT * FROM [dbo].[DimCustomer]\nSELECT COUNT(*) FROM [dbo].[DimCustomer]\n\nSELECT * FROM [dbo].[DimProduct]\nSELECT COUNT(*) FROM [dbo].[DimProduct]\n\n-- If we need to drop the tables\n\nDROP TABLE [dbo].[SalesFact]\n\nDROP TABLE [dbo].[DimCustomer]\n\nDROP TABLE [dbo].[DimProduct]\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "newpool",
				"poolName": "newpool"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}